<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Personal Library Catalog</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f7fa;
            line-height: 1.6;
            -webkit-text-size-adjust: 100%;
            font-size: 16px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 15px;
            text-align: center;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 1.8em;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 15px;
        }

        .warning-banner {
            background: rgba(255,255,255,0.15);
            padding: 12px;
            border-radius: 8px;
            font-size: 0.85em;
            backdrop-filter: blur(10px);
        }

        .main-content {
            padding: 0;
        }

        /* Mobile-first navigation tabs */
        .nav-tabs {
            display: flex;
            background: white;
            border-bottom: 1px solid #e2e8f0;
            position: sticky;
            top: 140px;
            z-index: 90;
        }

        .nav-tab {
            flex: 1;
            padding: 15px 10px;
            background: none;
            border: none;
            font-size: 14px;
            font-weight: 600;
            color: #64748b;
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            text-align: center;
        }

        .nav-tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
            background: #f8fafc;
        }

        .nav-tab:not(.active):hover {
            background: #f1f5f9;
        }

        .tab-content {
            display: none;
            padding: 20px 15px;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .stats {
            background: linear-gradient(135deg, #e6fffa 0%, #f0fff4 100%);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            border-left: 4px solid #38b2ac;
            text-align: center;
            font-weight: 600;
            color: #2d3748;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .form-section {
            background: white;
        }

        .form-section h2 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 1.4em;
            text-align: center;
        }

        .collapsible-section {
            margin-bottom: 20px;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            overflow: hidden;
            background: white;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .collapsible-header {
            background: #f8fafc;
            padding: 18px 20px;
            cursor: pointer;
            font-weight: 600;
            color: #2d3748;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s ease;
            border-bottom: 1px solid #e2e8f0;
            min-height: 60px;
            font-size: 16px;
        }

        .collapsible-header:active {
            background: #e2e8f0;
        }

        .collapsible-arrow {
            font-size: 14px;
            transition: transform 0.3s ease;
            color: #667eea;
        }

        .collapsible-section.collapsed .collapsible-arrow {
            transform: rotate(-90deg);
        }

        .collapsible-content {
            padding: 20px;
            transition: all 0.3s ease;
            max-height: 1000px;
            overflow: hidden;
        }

        .collapsible-section.collapsed .collapsible-content {
            max-height: 0;
            padding: 0 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
            font-size: 16px;
        }

        .form-group input, .form-group textarea {
            width: 100%;
            padding: 16px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
            min-height: 48px;
        }

        .form-group input:focus, .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
            transform: translateY(-1px);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 100px;
            font-family: inherit;
        }

        .color-section {
            margin-bottom: 20px;
        }

        .color-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 10px;
            margin: 15px 0;
        }

        .color-btn {
            width: 100%;
            aspect-ratio: 1;
            min-height: 44px;
            border: 3px solid transparent;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            touch-action: manipulation;
        }

        .color-btn:active {
            transform: scale(0.95);
        }

        .color-btn.selected {
            border-color: #2d3748;
            box-shadow: 0 0 0 3px #667eea;
            transform: scale(1.05);
        }

        .color-btn::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: white;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .color-btn.selected::after {
            opacity: 1;
        }

        .custom-color {
            margin-top: 15px;
        }

        .custom-color input {
            background: #f8fafc;
        }

        .shelf-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
            gap: 12px;
            margin-top: 15px;
        }

        .shelf-btn {
            padding: 16px 12px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 16px;
            font-weight: 600;
            color: #4a5568;
            min-height: 52px;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
        }

        .shelf-btn:active {
            transform: scale(0.95);
        }

        .shelf-btn.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
            transform: translateY(-2px);
        }

        .quick-fill-section {
            margin-top: 12px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .quick-fill-btn {
            padding: 12px 16px;
            border: 2px solid #cbd5e0;
            border-radius: 10px;
            background: #f7fafc;
            cursor: pointer;
            font-size: 14px;
            color: #4a5568;
            transition: all 0.3s ease;
            white-space: nowrap;
            min-height: 44px;
            touch-action: manipulation;
            font-weight: 500;
        }

        .quick-fill-btn:active {
            transform: scale(0.95);
            background: #e2e8f0;
        }

        .quick-fill-label {
            font-size: 12px;
            color: #718096;
            margin-bottom: 8px;
            font-weight: 600;
            width: 100%;
        }

        .buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 25px;
            padding: 0 5px;
        }

        .btn {
            padding: 18px 24px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 52px;
            touch-action: manipulation;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn:active {
            transform: translateY(1px) scale(0.98);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #f1f5f9;
            color: #475569;
            border: 2px solid #e2e8f0;
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(239, 68, 68, 0.3);
        }

        .file-section {
            margin-top: 20px;
            padding: 20px;
            background: #f8fafc;
            border-radius: 12px;
            border: 2px dashed #cbd5e0;
        }

        .file-section h3 {
            margin-bottom: 15px;
            color: #2d3748;
            font-size: 1.2em;
            text-align: center;
        }

        .file-input {
            margin-bottom: 15px;
        }

        .file-input input[type="file"] {
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            width: 100%;
            font-size: 16px;
            background: white;
            min-height: 52px;
        }

        /* Mobile-optimized table */
        .table-section h2 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 1.4em;
            text-align: center;
        }

        .mobile-cards {
            display: block;
        }

        .desktop-table {
            display: none;
        }

        .book-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
            position: relative;
        }

        .book-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .book-title {
            font-size: 1.1em;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 5px;
            line-height: 1.3;
        }

        .book-author {
            font-size: 0.95em;
            color: #64748b;
            font-weight: 500;
        }

        .book-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 15px;
        }

        .book-detail {
            display: flex;
            flex-direction: column;
        }

        .book-detail-label {
            font-size: 0.8em;
            font-weight: 600;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 2px;
        }

        .book-detail-value {
            font-size: 0.9em;
            color: #2d3748;
            font-weight: 500;
        }

        .book-color {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .color-indicator {
            width: 20px;
            height: 20px;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
            flex-shrink: 0;
        }

        .book-location {
            background: #f1f5f9;
            padding: 10px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
            font-weight: 600;
            color: #475569;
        }

        .book-description {
            background: #f8fafc;
            padding: 12px;
            border-radius: 8px;
            font-size: 0.9em;
            color: #4a5568;
            line-height: 1.4;
            margin-bottom: 15px;
        }

        .book-actions {
            display: flex;
            justify-content: flex-end;
        }

        .delete-btn {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
            border: none;
            padding: 10px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            min-height: 40px;
            touch-action: manipulation;
            transition: all 0.3s ease;
        }

        .delete-btn:active {
            transform: scale(0.95);
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #64748b;
        }

        .empty-state-icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .empty-state-text {
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        .empty-state-subtext {
            font-size: 0.9em;
            opacity: 0.8;
        }

        /* Search and filter */
        .search-section {
            margin-bottom: 20px;
            position: sticky;
            top: 200px;
            z-index: 80;
            background: white;
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
        }

        .search-input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 16px;
            background: #f8fafc;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        /* Responsive design */
        @media (min-width: 768px) {
            .container {
                border-radius: 12px;
                margin: 10px auto;
                min-height: calc(100vh - 20px);
            }

            .header {
                border-radius: 12px 12px 0 0;
                position: static;
            }

            .nav-tabs {
                position: static;
            }

            .search-section {
                position: static;
            }

            .color-grid {
                grid-template-columns: repeat(8, 1fr);
            }

            .book-details {
                grid-template-columns: repeat(3, 1fr);
            }

            .buttons {
                flex-direction: row;
                gap: 15px;
            }

            .btn {
                flex: 1;
            }
        }

        @media (min-width: 1024px) {
            .main-content {
                display: grid;
                grid-template-columns: 1fr 2fr;
                gap: 20px;
                padding: 20px;
            }

            .nav-tabs {
                display: none;
            }

            .tab-content {
                display: block;
                padding: 0;
                animation: none;
            }

            .mobile-cards {
                display: none;
            }

            .desktop-table {
                display: block;
            }

            .table-container {
                overflow-x: auto;
                border-radius: 8px;
                border: 1px solid #e2e8f0;
            }

            table {
                width: 100%;
                border-collapse: collapse;
                font-size: 14px;
            }

            th, td {
                padding: 12px;
                text-align: left;
                border-bottom: 1px solid #e2e8f0;
            }

            th {
                background: #f7fafc;
                font-weight: 600;
                color: #2d3748;
                position: sticky;
                top: 0;
            }

            tr:hover {
                background: #f7fafc;
            }
        }

        /* Loading and feedback states */
        .loading {
            text-align: center;
            padding: 20px;
            color: #64748b;
        }

        .success-message {
            background: #f0fff4;
            color: #22543d;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #38a169;
        }

        .error-message {
            background: #fed7d7;
            color: #742a2a;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #e53e3e;
        }

        /* Accessibility improvements */
        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Focus indicators */
        .nav-tab:focus,
        .btn:focus,
        .color-btn:focus,
        .shelf-btn:focus,
        .quick-fill-btn:focus {
            outline: 2px solid #667eea;
            outline-offset: 2px;
        }

        /* Animation for smooth interactions */
        .fade-in {
            animation: fadeIn 0.3s ease forwards;
        }

        .slide-up {
            animation: slideUp 0.3s ease forwards;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📚 Personal Library Catalog</h1>
            <p>Organize and catalog your personal book collection</p>
            <div class="warning-banner">
                <strong>⚠️ IMPORTANT:</strong> Import any existing catalog file before adding new books to avoid losing data!
            </div>
        </div>

        <!-- Mobile Navigation -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('add-book')">
                Add Book
            </button>
            <button class="nav-tab" onclick="showTab('view-books')">
                View Books
            </button>
            <button class="nav-tab" onclick="showTab('import-export')">
                Data
            </button>
        </div>

        <div class="main-content">
            <!-- Add Book Tab -->
            <div class="tab-content active" id="add-book-tab">
                <div class="form-section">
                    <div class="stats">
                        📖 Books Cataloged: <span id="bookCount">0</span>
                    </div>

                    <form id="bookForm">
                        <div class="collapsible-section" id="basicInfoSection">
                            <div class="collapsible-header" onclick="toggleSection('basicInfoSection')" role="button" tabindex="0">
                                📋 Basic Information
                                <span class="collapsible-arrow">▼</span>
                            </div>
                            <div class="collapsible-content">
                                <div class="form-group">
                                    <label for="author">Author:</label>
                                    <input type="text" id="author" name="author" required autocomplete="off">
                                    <div class="quick-fill-section" id="authorQuickFill"></div>
                                </div>

                                <div class="form-group">
                                    <label for="title">Title:</label>
                                    <input type="text" id="title" name="title" required autocomplete="off">
                                </div>

                                <div class="form-group">
                                    <label for="year">Year:</label>
                                    <input type="text" id="year" name="year" inputmode="numeric" autocomplete="off">
                                </div>

                                <div class="form-group">
                                    <label for="publisher">Publisher:</label>
                                    <input type="text" id="publisher" name="publisher" autocomplete="off">
                                    <div class="quick-fill-section" id="publisherQuickFill"></div>
                                </div>
                            </div>
                        </div>

                        <div class="collapsible-section" id="shelfLocationSection">
                            <div class="collapsible-header" onclick="toggleSection('shelfLocationSection')" role="button" tabindex="0">
                                📍 Shelf Location
                                <span class="collapsible-arrow">▼</span>
                            </div>
                            <div class="collapsible-content">
                                <div class="form-group">
                                    <label>Shelf Section:</label>
                                    <div class="shelf-grid" id="shelfSectionGrid"></div>
                                </div>

                                <div class="form-group">
                                    <label>Shelf Number:</label>
                                    <div class="shelf-grid" id="shelfNumberGrid"></div>
                                </div>
                            </div>
                        </div>

                        <div class="collapsible-section" id="appearanceSection">
                            <div class="collapsible-header" onclick="toggleSection('appearanceSection')" role="button" tabindex="0">
                                🎨 Cover Appearance
                                <span class="collapsible-arrow">▼</span>
                            </div>
                            <div class="collapsible-content">
                                <div class="color-section">
                                    <label>Cover Color:</label>
                                    <div class="color-grid" id="colorGrid"></div>
                                    <div class="custom-color">
                                        <label for="customColor">Or enter custom color:</label>
                                        <input type="text" id="customColor" name="customColor" placeholder="e.g., Dark Red, Forest Green, etc." autocomplete="off">
                                    </div>
                                </div>

                                <div class="form-group">
                                    <label for="coverDescription">Cover Description:</label>
                                    <textarea id="coverDescription" name="coverDescription" placeholder="Describe the front cover or spine design..." autocomplete="off"></textarea>
                                </div>
                            </div>
                        </div>

                        <div class="buttons">
                            <button type="submit" class="btn btn-primary">
                                ➕ Add Book
                            </button>
                            <button type="button" class="btn btn-secondary" onclick="clearForm()">
                                🗑️ Clear Form
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- View Books Tab -->
            <div class="tab-content" id="view-books-tab">
                <div class="table-section">
                    <h2>📚 Book Collection</h2>
                    
                    <div class="search-section">
                        <input type="text" class="search-input" id="searchInput" placeholder="🔍 Search books by title, author, or description...">
                    </div>

                    <!-- Mobile Cards View -->
                    <div class="mobile-cards" id="mobileCardsContainer">
                        <div class="empty-state" id="emptyState">
                            <div class="empty-state-icon">📚</div>
                            <div class="empty-state-text">No books in your library yet</div>
                            <div class="empty-state-subtext">Add your first book to get started!</div>
                        </div>
                    </div>

                    <!-- Desktop Table View -->
                    <div class="desktop-table">
                        <div class="table-container">
                            <table id="booksTable">
                                <thead>
                                    <tr>
                                        <th>Author</th>
                                        <th>Title</th>
                                        <th>Year</th>
                                        <th>Publisher</th>
                                        <th>Shelf Section</th>
                                        <th>Shelf Number</th>
                                        <th>Color</th>
                                        <th>Cover Description</th>
                                        <th>Action</th>
                                    </tr>
                                </thead>
                                <tbody id="booksTableBody">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Import/Export Tab -->
            <div class="tab-content" id="import-export-tab">
                <div class="file-section">
                    <h3>📥📤 Import/Export Data</h3>
                    
                    <div class="file-input">
                        <label for="fileImport">Import Previous Catalog (CSV/Excel):</label>
                        <input type="file" id="fileImport" accept=".csv,.xlsx,.xls" onchange="importFile(event)">
                    </div>

                    <div class="buttons">
                        <button class="btn btn-primary" onclick="exportToCSV()">
                            📄 Export to CSV
                        </button>
                        <button class="btn btn-primary" onclick="exportToExcel()">
                            📊 Export to Excel
                        </button>
                        <button class="btn btn-danger" onclick="clearAllData()">
                            🗑️ Clear All Data
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script>
        // Book collection storage
        let books = [];
        let selectedColor = '';
        let selectedShelfSection = '';
        let selectedShelfNumber = '';
        let filteredBooks = [];

        // Shelf sections (13 options)
        const shelfSections = ['A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M'];
        
        // Shelf numbers (7 options)
        const shelfNumbers = ['1', '2', '3', '4', '5', '6', '7'];

        // Expanded color palette
        const colors = [
            { name: 'Dark Red', value: '#8b0000' },
            { name: 'Crimson', value: '#dc143c' },
            { name: 'Red', value: '#ff0000' },
            { name: 'Fire Brick', value: '#b22222' },
            { name: 'Orange Red', value: '#ff4500' },
            { name: 'Orange', value: '#ffa500' },
            { name: 'Gold', value: '#ffd700' },
            { name: 'Yellow', value: '#ffff00' },
            { name: 'Chartreuse', value: '#7fff00' },
            { name: 'Lime Green', value: '#32cd32' },
            { name: 'Green', value: '#008000' },
            { name: 'Forest Green', value: '#228b22' },
            { name: 'Teal', value: '#008080' },
            { name: 'Aqua', value: '#00ffff' },
            { name: 'Light Blue', value: '#add8e6' },
            { name: 'Blue', value: '#0000ff' },
            { name: 'Royal Blue', value: '#4169e1' },
            { name: 'Navy Blue', value: '#000080' },
            { name: 'Purple', value: '#800080' },
            { name: 'Violet', value: '#ee82ee' },
            { name: 'Magenta', value: '#ff00ff' },
            { name: 'Pink', value: '#ffc0cb' },
            { name: 'Black', value: '#000000' },
            { name: 'Gray', value: '#808080' },
            { name: 'Silver', value: '#c0c0c0' },
            { name: 'White', value: '#ffffff' },
            { name: 'Brown', value: '#a52a2a' },
            { name: 'Coral', value: '#ff7f50' },
            { name: 'Peach', value: '#ffcba4' },
            { name: 'Cream', value: '#fffdd0' }
        ];

        // Initialize the application
        function init() {
            createColorGrid();
            createShelfSectionGrid();
            createShelfNumberGrid();
            updateBookCount();
            updateQuickFillButtons();
            setupCloseWarning();
            initializeCollapsibleSections();
            setupSearch();
            updateDisplay();
        }

        // Tab navigation
        function showTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all nav tabs
            document.querySelectorAll('.nav-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Activate corresponding nav tab
            event.target.classList.add('active');
            
            // Update display if viewing books
            if (tabName === 'view-books') {
                updateDisplay();
            }
        }

        // Setup search functionality
        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            searchInput.addEventListener('input', debounce(filterBooks, 300));
        }

        // Debounce function for search
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Filter books based on search
        function filterBooks() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            filteredBooks = books.filter(book => {
                return book.title.toLowerCase().includes(searchTerm) ||
                       book.author.toLowerCase().includes(searchTerm) ||
                       book.coverDescription.toLowerCase().includes(searchTerm) ||
                       book.publisher.toLowerCase().includes(searchTerm);
            });
            updateDisplay();
        }

        // Initialize collapsible sections based on screen size
        function initializeCollapsibleSections() {
            if (window.innerWidth <= 768) {
                // On mobile, collapse location and appearance sections
                document.getElementById('shelfLocationSection').classList.add('collapsed');
                document.getElementById('appearanceSection').classList.add('collapsed');
            }
        }

        // Toggle collapsible sections
        function toggleSection(sectionId) {
            const section = document.getElementById(sectionId);
            section.classList.toggle('collapsed');
        }

        // Setup warning when user tries to close tab
        function setupCloseWarning() {
            window.addEventListener('beforeunload', function(e) {
                if (books.length > 0) {
                    const message = 'Have you exported your library catalog? Your data will be lost if you close without exporting.';
                    e.preventDefault();
                    e.returnValue = message;
                    return message;
                }
            });
        }

        // Calculate top 5 most common authors
        function calculateTopAuthors() {
            const authorCounts = {};
            books.forEach(book => {
                if (book.author && book.author.trim()) {
                    const author = book.author.trim();
                    authorCounts[author] = (authorCounts[author] || 0) + 1;
                }
            });
            
            return Object.entries(authorCounts)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5)
                .map(([author, count]) => ({ name: author, count }));
        }

        // Calculate top 5 most common publishers
        function calculateTopPublishers() {
            const publisherCounts = {};
            books.forEach(book => {
                if (book.publisher && book.publisher.trim()) {
                    const publisher = book.publisher.trim();
                    publisherCounts[publisher] = (publisherCounts[publisher] || 0) + 1;
                }
            });
            
            return Object.entries(publisherCounts)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 5)
                .map(([publisher, count]) => ({ name: publisher, count }));
        }

        // Update quick-fill buttons
        function updateQuickFillButtons() {
            const authorQuickFill = document.getElementById('authorQuickFill');
            const publisherQuickFill = document.getElementById('publisherQuickFill');
            
            authorQuickFill.innerHTML = '';
            publisherQuickFill.innerHTML = '';
            
            const topAuthors = calculateTopAuthors();
            if (topAuthors.length > 0) {
                const authorLabel = document.createElement('div');
                authorLabel.className = 'quick-fill-label';
                authorLabel.textContent = 'Quick-fill (most common):';
                authorQuickFill.appendChild(authorLabel);
                
                topAuthors.forEach(({ name, count }) => {
                    const btn = document.createElement('button');
                    btn.type = 'button';
                    btn.className = 'quick-fill-btn';
                    btn.textContent = `${name} (${count})`;
                    btn.onclick = () => fillAuthor(name);
                    authorQuickFill.appendChild(btn);
                });
            }
            
            const topPublishers = calculateTopPublishers();
            if (topPublishers.length > 0) {
                const publisherLabel = document.createElement('div');
                publisherLabel.className = 'quick-fill-label';
                publisherLabel.textContent = 'Quick-fill (most common):';
                publisherQuickFill.appendChild(publisherLabel);
                
                topPublishers.forEach(({ name, count }) => {
                    const btn = document.createElement('button');
                    btn.type = 'button';
                    btn.className = 'quick-fill-btn';
                    btn.textContent = `${name} (${count})`;
                    btn.onclick = () => fillPublisher(name);
                    publisherQuickFill.appendChild(btn);
                });
            }
        }

        // Fill form functions
        function fillAuthor(authorName) {
            document.getElementById('author').value = authorName;
            document.getElementById('author').focus();
        }

        function fillPublisher(publisherName) {
            document.getElementById('publisher').value = publisherName;
            document.getElementById('publisher').focus();
        }

        // Create color selection grid
        function createColorGrid() {
            const colorGrid = document.getElementById('colorGrid');
            colors.forEach((color, index) => {
                const colorBtn = document.createElement('div');
                colorBtn.className = 'color-btn';
                colorBtn.style.backgroundColor = color.value;
                colorBtn.title = color.name;
                colorBtn.setAttribute('role', 'button');
                colorBtn.setAttribute('tabindex', '0');
                colorBtn.setAttribute('aria-label', `Select ${color.name} color`);
                colorBtn.onclick = () => selectColor(index, colorBtn);
                colorBtn.onkeydown = (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        selectColor(index, colorBtn);
                    }
                };
                colorGrid.appendChild(colorBtn);
            });
        }

        // Create shelf grids
        function createShelfSectionGrid() {
            const shelfSectionGrid = document.getElementById('shelfSectionGrid');
            shelfSections.forEach((section, index) => {
                const shelfBtn = document.createElement('div');
                shelfBtn.className = 'shelf-btn';
                shelfBtn.textContent = section;
                shelfBtn.setAttribute('role', 'button');
                shelfBtn.setAttribute('tabindex', '0');
                shelfBtn.setAttribute('aria-label', `Select shelf section ${section}`);
                shelfBtn.onclick = () => selectShelfSection(index, shelfBtn, section);
                shelfBtn.onkeydown = (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        selectShelfSection(index, shelfBtn, section);
                    }
                };
                shelfSectionGrid.appendChild(shelfBtn);
            });
        }

        function createShelfNumberGrid() {
            const shelfNumberGrid = document.getElementById('shelfNumberGrid');
            shelfNumbers.forEach((number, index) => {
                const shelfBtn = document.createElement('div');
                shelfBtn.className = 'shelf-btn';
                shelfBtn.textContent = number;
                shelfBtn.setAttribute('role', 'button');
                shelfBtn.setAttribute('tabindex', '0');
                shelfBtn.setAttribute('aria-label', `Select shelf number ${number}`);
                shelfBtn.onclick = () => selectShelfNumber(index, shelfBtn, number);
                shelfBtn.onkeydown = (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        selectShelfNumber(index, shelfBtn, number);
                    }
                };
                shelfNumberGrid.appendChild(shelfBtn);
            });
        }

        // Selection handlers
        function selectColor(index, element) {
            document.querySelectorAll('.color-btn').forEach(btn => {
                btn.classList.remove('selected');
                btn.setAttribute('aria-selected', 'false');
            });
            
            document.getElementById('customColor').value = '';
            
            element.classList.add('selected');
            element.setAttribute('aria-selected', 'true');
            selectedColor = colors[index].name;
        }

        function selectShelfSection(index, element, section) {
            document.querySelectorAll('#shelfSectionGrid .shelf-btn').forEach(btn => {
                btn.classList.remove('selected');
                btn.setAttribute('aria-selected', 'false');
            });
            
            element.classList.add('selected');
            element.setAttribute('aria-selected', 'true');
            selectedShelfSection = section;
        }

        function selectShelfNumber(index, element, number) {
            document.querySelectorAll('#shelfNumberGrid .shelf-btn').forEach(btn => {
                btn.classList.remove('selected');
                btn.setAttribute('aria-selected', 'false');
            });
            
            element.classList.add('selected');
            element.setAttribute('aria-selected', 'true');
            selectedShelfNumber = number;
        }

        // Handle custom color input
        document.getElementById('customColor').addEventListener('input', function(e) {
            if (e.target.value.trim()) {
                document.querySelectorAll('.color-btn').forEach(btn => {
                    btn.classList.remove('selected');
                    btn.setAttribute('aria-selected', 'false');
                });
                selectedColor = e.target.value.trim();
            }
        });

        // Handle form submission
        document.getElementById('bookForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const customColor = document.getElementById('customColor').value.trim();
            const finalColor = customColor || selectedColor;
            
            const book = {
                id: Date.now(),
                author: formData.get('author'),
                title: formData.get('title'),
                year: formData.get('year'),
                publisher: formData.get('publisher'),
                shelfSection: selectedShelfSection,
                shelfNumber: selectedShelfNumber,
                coverColor: finalColor,
                coverDescription: formData.get('coverDescription')
            };

            // Validation
            if (!finalColor) {
                showMessage('Please select a cover color or enter a custom color.', 'error');
                return;
            }

            if (!selectedShelfSection) {
                showMessage('Please select a shelf section.', 'error');
                return;
            }

            if (!selectedShelfNumber) {
                showMessage('Please select a shelf number.', 'error');
                return;
            }

            books.push(book);
            updateBookCount();
            updateQuickFillButtons();
            clearForm();
            
            showMessage('Book added successfully! 📚', 'success');
            
            // Auto-switch to view books tab on mobile
            if (window.innerWidth < 1024) {
                setTimeout(() => {
                    showTab('view-books');
                    document.querySelector('[onclick="showTab(\'view-books\')"]').classList.add('active');
                }, 1000);
            }
        });

        // Show message function
        function showMessage(message, type) {
            // Remove existing messages
            document.querySelectorAll('.success-message, .error-message').forEach(msg => {
                msg.remove();
            });
            
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'success' ? 'success-message' : 'error-message';
            messageDiv.textContent = message;
            
            const form = document.getElementById('bookForm');
            form.insertBefore(messageDiv, form.firstChild);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }

        // Clear the form
        function clearForm() {
            document.getElementById('bookForm').reset();
            document.querySelectorAll('.color-btn').forEach(btn => {
                btn.classList.remove('selected');
                btn.setAttribute('aria-selected', 'false');
            });
            document.querySelectorAll('.shelf-btn').forEach(btn => {
                btn.classList.remove('selected');
                btn.setAttribute('aria-selected', 'false');
            });
            document.getElementById('customColor').value = '';
            selectedColor = '';
            selectedShelfSection = '';
            selectedShelfNumber = '';
        }

        // Update display (mobile cards and desktop table)
        function updateDisplay() {
            const booksToDisplay = document.getElementById('searchInput').value ? filteredBooks : books;
            updateMobileCards(booksToDisplay);
            updateDesktopTable(booksToDisplay);
        }

        // Update mobile cards
        function updateMobileCards(booksToDisplay) {
            const container = document.getElementById('mobileCardsContainer');
            const emptyState = document.getElementById('emptyState');
            
            if (booksToDisplay.length === 0) {
                emptyState.style.display = 'block';
                // Clear existing cards
                container.querySelectorAll('.book-card').forEach(card => card.remove());
                return;
            }
            
            emptyState.style.display = 'none';
            
            // Clear existing cards
            container.querySelectorAll('.book-card').forEach(card => card.remove());
            
            booksToDisplay.forEach(book => {
                const card = createBookCard(book);
                container.appendChild(card);
            });
        }

        // Create book card for mobile
        function createBookCard(book) {
            const card = document.createElement('div');
            card.className = 'book-card slide-up';
            
            const colorObject = colors.find(c => c.name === book.coverColor);
            const colorValue = colorObject ? colorObject.value : book.coverColor.toLowerCase();
            
            card.innerHTML = `
                <div class="book-card-header">
                    <div>
                        <div class="book-title">${book.title}</div>
                        <div class="book-author">by ${book.author}</div>
                    </div>
                </div>
                
                <div class="book-location">
                    📍 Shelf ${book.shelfSection}${book.shelfNumber}
                </div>
                
                <div class="book-details">
                    <div class="book-detail">
                        <div class="book-detail-label">Year</div>
                        <div class="book-detail-value">${book.year || 'N/A'}</div>
                    </div>
                    <div class="book-detail">
                        <div class="book-detail-label">Publisher</div>
                        <div class="book-detail-value">${book.publisher || 'N/A'}</div>
                    </div>
                    <div class="book-detail">
                        <div class="book-detail-label">Cover Color</div>
                        <div class="book-detail-value">
                            <div class="book-color">
                                <div class="color-indicator" style="background-color: ${colorValue}"></div>
                                ${book.coverColor}
                            </div>
                        </div>
                    </div>
                </div>
                
                ${book.coverDescription ? `
                    <div class="book-description">
                        ${book.coverDescription}
                    </div>
                ` : ''}
                
                <div class="book-actions">
                    <button class="delete-btn" onclick="deleteBook(${book.id})">
                        🗑️ Delete
                    </button>
                </div>
            `;
            
            return card;
        }

        // Update desktop table
        function updateDesktopTable(booksToDisplay) {
            const tbody = document.getElementById('booksTableBody');
            tbody.innerHTML = '';

            booksToDisplay.forEach(book => {
                const row = tbody.insertRow();
                
                const colorObject = colors.find(c => c.name === book.coverColor);
                const colorValue = colorObject ? colorObject.value : book.coverColor.toLowerCase();
                
                row.innerHTML = `
                    <td>${book.author}</td>
                    <td>${book.title}</td>
                    <td>${book.year}</td>
                    <td>${book.publisher}</td>
                    <td>${book.shelfSection}</td>
                    <td>${book.shelfNumber}</td>
                    <td>
                        <div class="color-indicator" style="background-color: ${colorValue}" title="${book.coverColor}"></div>
                        ${book.coverColor}
                    </td>
                    <td>${book.coverDescription}</td>
                    <td>
                        <button class="delete-btn" onclick="deleteBook(${book.id})">Delete</button>
                    </td>
                `;
            });
        }

        // Delete a book
        function deleteBook(bookId) {
            if (confirm('Are you sure you want to delete this book?')) {
                books = books.filter(book => book.id !== bookId);
                updateBookCount();
                updateQuickFillButtons();
                updateDisplay();
                showMessage('Book deleted successfully', 'success');
            }
        }

        // Update book count
        function updateBookCount() {
            document.getElementById('bookCount').textContent = books.length;
        }

        // Clear all data
        function clearAllData() {
            if (books.length === 0) {
                showMessage('No data to clear', 'error');
                return;
            }
            
            if (confirm('Are you sure you want to delete ALL books? This cannot be undone!')) {
                books = [];
                filteredBooks = [];
                updateBookCount();
                updateQuickFillButtons();
                updateDisplay();
                showMessage('All data cleared successfully', 'success');
            }
        }

        // Export functions
        function exportToCSV() {
            if (books.length === 0) {
                showMessage('No books to export!', 'error');
                return;
            }

            const headers = ['Author', 'Title', 'Year', 'Publisher', 'Shelf Section', 'Shelf Number', 'Cover Color', 'Cover Description'];
            const csvContent = [
                headers.join(','),
                ...books.map(book => [
                    `"${book.author}"`,
                    `"${book.title}"`,
                    `"${book.year}"`,
                    `"${book.publisher}"`,
                    `"${book.shelfSection}"`,
                    `"${book.shelfNumber}"`,
                    `"${book.coverColor}"`,
                    `"${book.coverDescription}"`
                ].join(','))
            ].join('\n');

            downloadFile(csvContent, 'library-catalog.csv', 'text/csv');
            showMessage('CSV exported successfully! 📄', 'success');
        }

        function exportToExcel() {
            if (books.length === 0) {
                showMessage('No books to export!', 'error');
                return;
            }

            const worksheet = XLSX.utils.json_to_sheet(books.map(book => ({
                'Author': book.author,
                'Title': book.title,
                'Year': book.year,
                'Publisher': book.publisher,
                'Shelf Section': book.shelfSection,
                'Shelf Number': book.shelfNumber,
                'Cover Color': book.coverColor,
                'Cover Description': book.coverDescription
            })));

            const workbook = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(workbook, worksheet, 'Library Catalog');
            XLSX.writeFile(workbook, 'library-catalog.xlsx');
            showMessage('Excel file exported successfully! 📊', 'success');
        }

        // Import file
        function importFile(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            
            if (file.name.endsWith('.csv')) {
                reader.onload = function(e) {
                    parseCSV(e.target.result);
                };
                reader.readAsText(file);
            } else if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) {
                reader.onload = function(e) {
                    parseExcel(e.target.result);
                };
                reader.readAsArrayBuffer(file);
            }
        }

        // Parse functions
        function parseCSV(csvText) {
            const lines = csvText.split('\n');
            const headers = lines[0].split(',').map(h => h.replace(/"/g, '').trim());
            let importedCount = 0;
            
            for (let i = 1; i < lines.length; i++) {
                if (lines[i].trim() === '') continue;
                
                const values = lines[i].split(',').map(v => v.replace(/"/g, '').trim());
                const book = {
                    id: Date.now() + i,
                    author: values[0] || '',
                    title: values[1] || '',
                    year: values[2] || '',
                    publisher: values[3] || '',
                    shelfSection: values[4] || '',
                    shelfNumber: values[5] || '',
                    coverColor: values[6] || '',
                    coverDescription: values[7] || ''
                };
                
                books.push(book);
                importedCount++;
            }
            
            updateBookCount();
            updateQuickFillButtons();
            updateDisplay();
            showMessage(`Successfully imported ${importedCount} books! 📚`, 'success');
        }

        function parseExcel(data) {
            const workbook = XLSX.read(data, { type: 'array' });
            const worksheet = workbook.Sheets[workbook.SheetNames[0]];
            const jsonData = XLSX.utils.sheet_to_json(worksheet);
            
            jsonData.forEach((row, index) => {
                const book = {
                    id: Date.now() + index,
                    author: row['Author'] || '',
                    title: row['Title'] || '',
                    year: row['Year'] || '',
                    publisher: row['Publisher'] || '',
                    shelfSection: row['Shelf Section'] || '',
                    shelfNumber: row['Shelf Number'] || '',
                    coverColor: row['Cover Color'] || '',
                    coverDescription: row['Cover Description'] || ''
                };
                
                books.push(book);
            });
            
            updateBookCount();
            updateQuickFillButtons();
            updateDisplay();
            showMessage(`Successfully imported ${jsonData.length} books! 📚`, 'success');
        }

        // Download file helper
        function downloadFile(content, filename, contentType) {
            const blob = new Blob([content], { type: contentType });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        // Initialize the application when the page loads
        window.onload = init;

        // Handle window resize
        window.addEventListener('resize', debounce(() => {
            initializeCollapsibleSections();
        }, 250));

        // Handle orientation change
        window.addEventListener('orientationchange', () => {
            setTimeout(initializeCollapsibleSections, 300);
        });

        // Keyboard navigation for collapsible sections
        document.addEventListener('keydown', function(e) {
            if (e.target.classList.contains('collapsible-header')) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    e.target.click();
                }
            }
        });
    </script>
</body>
</html>
